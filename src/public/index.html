<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Global Garden</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Verlinkung zur externen CSS-Datei -->
    <link rel="stylesheet" href="style.css" />

    <!-- p5.js Library f√ºr kreative Generative Gestaltung -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.2.0/p5.min.js"></script>

    <!-- Neue Datenquellen von Our World in Data -->
    <script src="air.js"></script>
    <script src="biodiversity.js"></script>
    <script src="co2.js"></script>
    <script src="renewables.js"></script>
    <script src="waste.js"></script>
    <script src="water.js"></script>

    <!-- Haupt-JavaScript f√ºr Flower-Logik -->
    <script src="flower.js"></script>
  </head>
  <body>

    <!-- ‚¨ÖÔ∏è Titelbereich oben links -->
    <div class="title-box">
      <h1>Global Garden</h1>
      <p>
        A digital world map where each country is represented by a unique flower.
        The shape, color, and growth of each bloom are based on environmental factors
        like CO‚ÇÇ emissions, biodiversity, or renewable energy usage.
      </p>
    </div>

    <!-- üîÅ Wiedergabe-Fortsetzung -->
    <div style="position: absolute; top: 20px; left: 50%; transform: translateX(-50%); z-index: 30;">
      <button id="audio-toggle-btn"
        style="background: #fff; color: #000; border: none; padding: 8px 16px; font-size: 16px; border-radius: 6px;">
        ‚ñ∂ Hear the Global Garden
      </button>
      <audio id="global-audio" src="audio_the_Global_Garden.mp3"></audio>
    </div>


    <!-- ‚¨ÖÔ∏è Legende unten links -->
    <div class="legend">
      <h3>Environmental Indicators:</h3>
      <ul>
        <li><span style="background-color: #ff0000;"></span> Low CO‚ÇÇ</li>
        <li><span style="background-color: #00c864;"></span> Renewables</li>
        <li><span style="background-color: #0090ff;"></span> Low Water</li>
        <li><span style="background-color: #ffee00;"></span> Clean Air</li>
        <li><span style="background-color: #b000ff;"></span> Biodiversity</li>
        <li><span style="background-color: #ffa500;"></span> Low Waste</li>
         <!-- <li><span style="background-color: #ffffff;"></span> Transparency</li>  -->
      </ul>
    </div>


    
    <!-- ‚¨ÖÔ∏è Zur√ºck-Button oben rechts -->
    <a href="homescreen.html" class="back-button" style="position:fixed; top:20px; right:20px; background:#333; color:#fff; padding:10px 20px; text-decoration:none; border-radius:8px; font-size:14px; z-index:1000;">‚Üê Back to Map</a>


  <script>
  const audio = document.getElementById("global-audio");
  const button = document.getElementById("audio-toggle-btn");

  // Audio-Status aus localStorage lesen
  const resume = localStorage.getItem("audioPlaying") === "true";
  const time = parseFloat(localStorage.getItem("audioTime") || 0);
  const volume = parseFloat(localStorage.getItem("audioVolume") || 1);

  // Volume setzen
  audio.volume = volume;

  // Sanftere Audio-Fortsetzung ohne st√∂rende Unterbrechung
  if (resume && time > 0) {
    // Kleine Verz√∂gerung, um sicherzustellen, dass die Seite vollst√§ndig geladen ist
    setTimeout(() => {
      audio.currentTime = time;
      audio.play().then(() => {
        button.textContent = "‚è∏ Pause Audio";
      }).catch(err => {
        console.warn("Autoplay blocked - User muss Play dr√ºcken");
        // Falls Autoplay blockiert, Button-Text anpassen
        button.textContent = "‚ñ∂ Resume Audio";
      });
    }, 100);
  }

  button.addEventListener("click", () => {
    if (audio.paused) {
      audio.play().then(() => {
        button.textContent = "‚è∏ Pause Audio";
      }).catch(err => {
        console.warn("Audio play failed");
      });
    } else {
      audio.pause();
      button.textContent = "‚ñ∂ Hear the Global Garden";
    }
  });

  audio.addEventListener("ended", () => {
    button.textContent = "‚ñ∂ Hear the Global Garden";
    localStorage.setItem("audioPlaying", "false");
  });

  // Audio-Status kontinuierlich speichern f√ºr nahtlose Navigation
  setInterval(() => {
    if (!audio.paused) {
      localStorage.setItem("audioPlaying", "true");
      localStorage.setItem("audioTime", audio.currentTime);
      localStorage.setItem("audioVolume", audio.volume);
    } else {
      localStorage.setItem("audioPlaying", "false");
    }
  }, 250);

  // Vor der Navigation Audio-Zustand speichern
  window.addEventListener("beforeunload", () => {
    if (!audio.paused) {
      localStorage.setItem("audioPlaying", "true");
      localStorage.setItem("audioTime", audio.currentTime);
      localStorage.setItem("audioVolume", audio.volume);
    }
  });
</script>

  </body>
</html>